<!DOCTYPE HTML>
<html>
    <head>
    <meta charset="utf-8">
    <title>Beer Brawl</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <style type="text/css" media="screen">
@import "/jqtouch/themes/css/jqtouch.css";
</style>
    <style type="text/css" media="screen">
.validation {
	color: #E71212;
}
</style>
    <script src="/jqtouch/src/jqtouch.js" type="text/javascript" charset="utf-8"></script>
    <script src="/jqtouch/src/jqtouch-jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
      var jQT = $.jQTouch({
        statusBar: 'black'
      });
	  
	  function OfferInfo(canSize, cansInPack, numberOfPacks, cost) {
		  this.CanSize = canSize;
		  this.CansInPack = cansInPack;
		  this.NumberOfPacks = numberOfPacks;
		  this.Cost = cost;
	  }
	  
	  OfferInfo.prototype.getPricePer100ml = function () {
		  var totalCans = this.CansInPack * this.NumberOfPacks;
		  var totalMl = totalCans * this.CanSize;
		  var totalCl = totalMl / 100;
		  return (this.Cost / totalCl).toFixed(2);
	  }
	  
	  OfferInfo.prototype.compare = function (otherOffer) {
		  return this.getPricePer100ml() < otherOffer.getPricePer100ml() ? this : otherOffer;
	  }
	    
	  $(document).ready(function() {
		  debugPopulateOffers();
		  
		  $('#brawlbutton').click(function (){
			  // get offer info
			  var offer1 = getOfferInfo("#offer1");
			  var offer2 = getOfferInfo("#offer2");			  
			  
			  // calculate winner
			  var offer1per100ml = offer1.getPricePer100ml();
			  var offer2per100ml = offer2.getPricePer100ml();		  
			  
			  var offer1percan = (offer1per100ml / 100) * offer1.CanSize;
			  var offer2percan = (offer1per100ml / 100) * offer1.CanSize;
			  			  
			  var resultHeadline = (offer1per100ml < offer2per100ml) ? "Offer 1 wins!" : "Offer 2 wins!";
			  if(offer1per100ml === offer2per100ml) {
				  resultHeadline = "Both Offers The Same!";
			  }

			  // show result
			  // TODO
			  // Move this template out to ID based placeholders			  
			  var $result = $("#result");			  				  
			  $result
			  	.append("<h1>" + resultHeadline + "</h1>")
				.append("<h2>Cost per 100ml</h2>")
			  	.append("<p>Offer 1 = " + offer1per100ml.toFixed(2) + "</p>")
			  	.append("<p>Offer 2 = " + offer2per100ml.toFixed(2) + "</p>")
				.append("<h2>Cost per can</h2>")
				.append("Offer 1 = " + offer1percan.toFixed(2) + "</p>")
				.append("Offer 2 = " + offer2percan.toFixed(2) + "</p>");
		  });
		  
		  $("#startover").click(function(e) {
            resetBeerBrawl();
        });
		
		$("#winnerstayson").click(function(e) {
            winnerStaysOn();
        });
  
			$('#offer1').bind('pageAnimationStart', function(e, data){
				if (data.direction == 'out')
				{
					validateRequiredField(e, "#offer1 .cansize", "Can Size");
					validateRequiredField(e, "#offer1 .cansinpack", "Cans In Pack");
					validateRequiredField(e, "#offer1 .numberofpacks", "Number Of Packs");
					validateRequiredField(e, "#offer1 .cost", "Offer Cost");
				}
			});
			
			$('#offer2').bind('pageAnimationStart', function(e, data){
				if (data.direction == 'out')
				{
					validateRequiredField(e, "#offer2 .cansize", "Can Size");
					validateRequiredField(e, "#offer2 .cansinpack", "Cans In Pack");
					validateRequiredField(e, "#offer2 .numberofpacks", "Number Of Packs");
					validateRequiredField(e, "#offer2 .cost", "Offer Cost");
				}
			});
			
					
	  });
	  
	  function getOfferInfo(selector) {
		  var $offer = $(selector);
		  var offerInfo = new OfferInfo();
		  
		  offerInfo.CanSize = $offer.find(".cansize").val();
		  offerInfo.CansInPack = $offer.find(".cansinpack").val();
		  offerInfo.NumberOfPacks = $offer.find(".numberofpacks").val();
		  offerInfo.Cost = $offer.find(".cost").val();
		  
		  return offerInfo;
	  }
	  
	  function populateOfferUI(selector, offerInfo) {
		  var $offer = $(selector);
		  $offer.find(".cansize").val(offerInfo.CanSize);
		  $offer.find(".cansinpack").val(offerInfo.CansInPack);
		  $offer.find(".numberofpacks").val(offerInfo.NumberOfPacks);
		  $offer.find(".cost").val(offerInfo.Cost);
	  }

	  function validateRequiredField(e, selector, name) {
		if($(selector).val() == "") {
		  $(selector).next(".validation").text(name + " is required!");
		  e.preventDefault();
		}		  
		else {
		  $(selector).next(".validation").empty();	
		}
	  }
	  
	  function resetBeerBrawl() {
		  $(".input").val("");
		  $(".validation").empty();
		  $("#result").empty();
	  }
	  
	  function winnerStaysOn() {
		  var winningOffer = getOfferInfo("#offer1").compare(getOfferInfo("#offer2"));
		  resetBeerBrawl();
		  populateOfferUI("#offer1", winningOffer);
	  }
	  
	  function debugPopulateOffers() {
		  populateOfferUI("#offer1", new OfferInfo(440, 10, 10, 10));
		  populateOfferUI("#offer2", new OfferInfo(440, 20, 20, 20));		  
	  }
    </script>
    </head>

    <body>
    <div id="jqt">
      <div id="offer1">
        <div class="toolbar">
          <h1>Beer Brawl</h1>
        </div>
        <ul class="edit rounded">
          <li>
            <input type="number" name="cansize1" class="input cansize" placeholder="Can Size (ml)" />
            <div class="validation"></div>
          </li>
          <li>
            <input type="number" name="cansinpack1" class="input cansinpack" placeholder="Cans In Pack" />
            <div class="validation"></div>
          </li>
          <li>
            <input type="number" name="numberofpacks1" class="input numberofpacks" placeholder="Number Of Packs" />
            <div class="validation"></div>
          </li>
          <li>
            <input type="number" name="cost1" class="input cost" placeholder="Cost" />
            <div class="validation"></div>
          </li>
        </ul>
        <ul class="rounded">
          <li> <a class="greenButton" href="#offer2">Add Contender</a> </li>
        </ul>
      </div>
      <div id="offer2">
        <div class="toolbar">
          <h1>Add Contender</h1>
          <a href="#" class="back">Back</a> </div>
        <ul class="edit rounded">
          <li>
            <input type="number" name="cansize2" class="input cansize" placeholder="Can Size (ml)" />
            <div class="validation"></div>
          </li>
          <li>
            <input type="number" name="cansinpack2" class="input cansinpack" placeholder="Cans In Pack" />
            <div class="validation"></div>
          </li>
          <li>
            <input type="number" name="numberofpacks2" class="input numberofpacks" placeholder="Number Of Packs" />
            <div class="validation"></div>
          </li>
          <li>
            <input type="number" name="cost2" class="input cost" placeholder="Cost" />
            <div class="validation"></div>
          </li>
        </ul>
        <ul class="rounded">
          <li><a class="greenButton" id="brawlbutton" href="#brawl">Brawl!</a></li>
        </ul>
      </div>
      <div id="brawl">
        <div class="toolbar">
          <h1>Brawl Winner</h1>
        </div>
        <ul class="edit rounded">
          <li id="result"></li>
        </ul>
        <ul class="rounded">
          <li><a class="greenButton" id="winnerstayson" href="#offer2">Winner Stays On</a></li>
          <li><a class="redButton" id="startover" href="#offer1">Start Over</a></li>
        </ul>
      </div>
    </div>
</body>
</html>
